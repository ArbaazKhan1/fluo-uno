#!/bin/bash

# Versions
# --------
export FLUO_VERSION=1.0.0-beta-2
export HADOOP_VERSION=2.6.3
export ZOOKEEPER_VERSION=3.4.6
export ACCUMULO_VERSION=1.7.1
export SPARK_VERSION=1.5.1
export SPARK_BIN_VERSION=$SPARK_VERSION-bin-hadoop2.6
#if using Accumulo 1.8.X, then set to 0.9.3.
export THRIFT_VERSION=0.9.1

# Download configuration
# ----------------------
# Directory where all depedency packages are downloaded
export DOWNLOADS=$FLUO_DEV/downloads
# Apache download mirror used by 'fluo-dev download'
# Pick another mirror at http://www.apache.org/dyn/closer.cgi
export APACHE_MIRROR=http://www.gtlib.gatech.edu/pub/apache
# Tarball file names
export ACCUMULO_TARBALL=accumulo-$ACCUMULO_VERSION-bin.tar.gz
export HADOOP_TARBALL=hadoop-"$HADOOP_VERSION".tar.gz
export ZOOKEEPER_TARBALL=zookeeper-"$ZOOKEEPER_VERSION".tar.gz
export SPARK_TARBALL=spark-"$SPARK_BIN_VERSION".tgz

# Building Accumulo
#------------------
#If ACCUMULO_TARBALL_REPO is set then 'fluo_dev download' will build Accumulo
#from that directory and copy it to the downloads directory.  When a repo is
#set for Accumulo no download is attempted.
#
#export ACCUMULO_TARBALL_REPO=

# Fluo Tarball
# ------------
# Configures how to retrieve/build Fluo distribution tarball used by 'deploy' command.
# If multiple variables are set, the following order of precedence is used:
#
# 1. FLUO_TARBALL_PATH - Local path where Fluo distribution tarball exists
# 2. FLUO_TARBALL_REPO - Clone of Fluo repo which will be used to generate tarball
# 3. FLUO_TARBALL_URL - Location to download Fluo tarball (set by default)
#
# If all variables are commented out, Fluo will not be set up

#export FLUO_TARBALL_PATH=/path/to/fluo-distribution-1.0.0-beta-1-bin.tar.gz
#export FLUO_TARBALL_REPO=/path/to/local/git/repo/fluo
export FLUO_TARBALL_URL=https://github.com/fluo-io/fluo/releases/download/$FLUO_VERSION/fluo-distribution-$FLUO_VERSION-bin.tar.gz

# Installation directories
# ------------------------
# Software installation directory
export INSTALL=$FLUO_DEV/install
# Directory where all Fluo dependencies store their data
export DATA_DIR=$INSTALL/data
# Fluo home
export FLUO_HOME=$INSTALL/fluo-$FLUO_VERSION
# Zookeeper home
export ZOOKEEPER_HOME=$INSTALL/zookeeper-$ZOOKEEPER_VERSION
# Hadoop
export HADOOP_PREFIX=$INSTALL/hadoop-$HADOOP_VERSION
export HADOOP_CONF_DIR=$HADOOP_PREFIX/etc/hadoop
# Accumulo Home
export ACCUMULO_HOME=$INSTALL/accumulo-$ACCUMULO_VERSION
# Spark home
export SPARK_HOME=$INSTALL/spark-$SPARK_BIN_VERSION

# Accumulo configuration
# ----------------------
# Accumulo instance name
export ACCUMULO_INSTANCE=instance16
# Accumulo user
export ACCUMULO_USER=root
# Accumulo password
export ACCUMULO_PASSWORD=secret

# Metrics configuration
# ------------------------
# If true, fluo-dev will setup metrics (i.e InfluxDB & Grafana)
export SETUP_METRICS=false
# InfuxDB configuration
export INFLUXDB_VERSION=0.9.4.2
export INFLUXDB_HOME=$INSTALL/influxdb-"$INFLUXDB_VERSION"
# Grafana configuration
export GRAFANA_VERSION=2.5.0
export GRAFANA_HOME=$INSTALL/grafana-"$GRAFANA_VERSION"
# If true, will build executables from source. 
# On Mac OX, fluo-dev will always build from source
export BUILD_INFLUXDB=false
export BUILD_GRAFANA=false


#Performance Profiles
#--------------------

PERFORMACE_PROFILE=8GX2

case "$PERFORMACE_PROFILE" in
  8GX2)
    #Accumulo tserver jvm heap size
    export ACCUMULO_TSERV_MEM=768m
    #Accumulo data cache size
    export ACCUMULO_DCACHE_SIZE=256M
    #Accumulo index cache size
    export ACCUMULO_ICACHE_SIZE=128M
    #Accumulo in mem map size
    export ACCUMULO_IMAP_SIZE=128M
    # Yarn Node Manager max memory (in MB)
    export YARN_NM_MEM_MB=8192
    # Yarn Node Manager max cpu vcores
    export YARN_NM_CPU_VCORES=8
    # Number of threads per worker process
    export FLUO_WORKER_THREADS=10
    # Worker process memory
    export FLUO_WORKER_MEM_MB=1024
    # Number worker processes
    export FLUO_WORKER_INSTANCES=1
    ;;
  32GX4)
    export ACCUMULO_TSERV_MEM=6G
    export ACCUMULO_DCACHE_SIZE=2G
    export ACCUMULO_ICACHE_SIZE=1G
    export ACCUMULO_IMAP_SIZE=1G
    export YARN_NM_MEM_MB=16384
    export YARN_NM_CPU_VCORES=8
    export FLUO_WORKER_THREADS=64
    export FLUO_WORKER_MEM_MB=4096
    export FLUO_WORKER_INSTANCES=2
    ;;
  *)
   echo "Unknown performance profile"
   exit 1;
   ;;
esac
